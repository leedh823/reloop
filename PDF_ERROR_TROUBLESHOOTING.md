# PDF 파싱 오류 해결 가이드

## 🔴 현재 오류

**오류 메시지:**
```
PDF 파일을 읽는 중 오류가 발생했습니다.
```

**상황:**
- 28MB 크기의 PDF 파일 업로드
- `/api/ai/analyze-file` 엔드포인트에서 500 Internal Server Error 발생

## 🔍 가능한 원인

### 1. 파일 크기 문제 (가장 가능성 높음)
- **28MB는 매우 큰 PDF 파일입니다**
- Vercel Serverless Functions의 메모리 제한 (약 1GB)
- PDF 파싱 시 메모리 사용량이 파일 크기의 3-5배까지 증가할 수 있음

### 2. 타임아웃
- PDF 파싱 타임아웃: 30초
- 복잡한 PDF는 파싱에 시간이 오래 걸릴 수 있음

### 3. PDF 파일 형식 문제
- 이미지만 포함된 PDF (스캔본)
- 암호화된 PDF
- 손상된 PDF

## ✅ 해결 방법

### 방법 1: 파일 크기 줄이기 (권장)

1. **PDF 압축**
   - 온라인 도구: https://www.ilovepdf.com/compress-pdf
   - 또는 Adobe Acrobat 사용
   - 목표: 10MB 이하

2. **PDF 분할**
   - 큰 파일을 여러 개로 나누기
   - 각 파일을 개별적으로 분석

### 방법 2: 파일 형식 확인

1. **텍스트가 포함된 PDF인지 확인**
   - 이미지만 포함된 PDF는 텍스트 추출 불가
   - 텍스트가 포함된 PDF만 지원

2. **PDF 열기 테스트**
   - PDF 파일이 정상적으로 열리는지 확인
   - 손상되지 않았는지 확인

### 방법 3: 서버 로그 확인

**로컬 개발 서버:**
터미널에서 다음 로그를 확인하세요:
```
[analyze-file] PDF 파싱 시작: ...
[analyze-file] ArrayBuffer 생성 완료: ...
[analyze-file] PDF 파싱 오류 (상세): ...
```

**Vercel 프로덕션:**
1. Vercel 대시보드 → 프로젝트
2. Deployments → 최신 배포
3. Functions 탭 → `/api/ai/analyze-file` 클릭
4. 로그에서 상세 오류 확인

## 📊 파일 크기 권장사항

| 파일 크기 | 상태 | 권장 조치 |
|---------|------|----------|
| ~5MB | ✅ 정상 | 그대로 사용 가능 |
| 5-10MB | ⚠️ 주의 | 가능하면 압축 |
| 10-20MB | ⚠️ 경고 | 압축 또는 분할 권장 |
| 20MB+ | ❌ 문제 | 반드시 압축 또는 분할 필요 |

## 🛠️ 개선된 오류 메시지

이제 더 구체적인 오류 메시지가 표시됩니다:

- **타임아웃:** "PDF 파일 분석 시간이 초과되었습니다. (28.0MB)"
- **메모리 부족:** "PDF 파일이 너무 커서 메모리 부족이 발생했습니다. (28.0MB)"
- **손상된 파일:** "PDF 파일이 손상되었거나 읽을 수 없는 형식입니다."

## 🔧 개발자용 디버깅

### 로컬에서 테스트

1. **작은 PDF 파일로 테스트**
   - 1-2MB 크기의 간단한 PDF로 먼저 테스트
   - 정상 작동하면 파일 크기 문제일 가능성 높음

2. **서버 로그 확인**
   - 터미널에서 상세 로그 확인
   - `[analyze-file]`로 시작하는 로그 확인

3. **메모리 사용량 확인**
   - Node.js 메모리 제한 확인
   - 필요시 `--max-old-space-size` 옵션 사용

## 💡 대안

### 대안 1: 텍스트 파일로 변환
1. PDF를 텍스트로 변환
2. `.txt` 또는 `.md` 파일로 저장
3. 변환된 파일 업로드

### 대안 2: 파일 분할
1. PDF를 여러 페이지로 분할
2. 각 부분을 개별적으로 분석
3. 결과를 수동으로 통합

### 대안 3: 클라이언트 사이드 파싱 (향후)
- 브라우저에서 PDF 파싱
- 서버 부하 감소
- 더 큰 파일 처리 가능

## 📝 체크리스트

- [ ] PDF 파일 크기가 20MB 이하인지 확인
- [ ] PDF 파일이 텍스트를 포함하는지 확인
- [ ] PDF 파일이 정상적으로 열리는지 확인
- [ ] 서버 로그에서 구체적인 오류 메시지 확인
- [ ] 더 작은 PDF 파일로 테스트


